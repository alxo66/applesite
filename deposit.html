<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #f5f6f8;
}

header {
  background: #fff;
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  box-shadow: 0 2px 10px rgba(0,0,0,.05);
}

header a {
  text-decoration: none;
  margin-left: 16px;
  color: #000;
  font-weight: 500;
}

.container {
  max-width: 600px;
  margin: 40px auto;
  padding: 0 20px;
}

.card {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,.05);
}

h2 {
  margin-top: 0;
}

label {
  display: block;
  margin-top: 16px;
  font-weight: 500;
}

input, select {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #ddd;
  margin-top: 8px;
  font-size: 15px;
}

button {
  margin-top: 24px;
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 14px;
  background: #0071e3;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
}

.notice {
  margin-top: 16px;
  font-size: 14px;
  color: #555;
}
</style>
</head>

<body>

<header>
  <strong>üçé –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</strong>
  <nav>
    <a href="/">–ú–∞–≥–∞–∑–∏–Ω</a>
    <a href="/cabinet.html">–ö–∞–±–∏–Ω–µ—Ç</a>
  </nav>
</header>

<div class="container">
  <div class="card">
    <h2>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h2>

    <label>–°—É–º–º–∞</label>
    <input id="amount" type="number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5000">

    <label>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</label>
    <select id="asset">
      <option value="USDT">USDT</option>
      <option value="BTC">BTC</option>
      <option value="ETH">ETH</option>
      <option value="TON">TON</option>
    </select>

    <button id="payBtn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>

    <div class="notice">
      –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ CryptoBot. –ë–∞–ª–∞–Ω—Å –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.
    </div>
  </div>
</div>

<script type="module">
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Ç–≤–æ–µ–≥–æ api.js (—É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—É—Ç—å –≤–µ—Ä–Ω—ã–π)
    // –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –∫–æ–¥, –µ—Å–ª–∏ api.js –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
    
    const API = "https://applestore-backend-production.up.railway.app";

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∞–∫–∞—è –∂–µ, –∫–∞–∫ –≤ api.js)
    function getUserId() {
        let userId = localStorage.getItem("applestore_user_id");
        if (!userId) {
            userId = "user_" + Math.random().toString(36).substring(2, 11);
            localStorage.setItem("applestore_user_id", userId);
        }
        return userId;
    }

    document.getElementById("payBtn").onclick = async () => {
        const btn = document.getElementById("payBtn");
        const amount = Number(document.getElementById("amount").value);
        const currency = document.getElementById("asset").value; // –ú–µ–Ω—è–µ–º asset –Ω–∞ currency –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

        if (!amount || amount <= 0) {
            alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –≤ USDT");
            return;
        }

        btn.disabled = true;
        btn.innerText = "–°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞...";

        try {
            const r = await fetch(API + "/api/deposit", { // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "x-user-id": getUserId() // –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                },
                body: JSON.stringify({
                    amount,
                    currency // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ currency
                })
            });

            const data = await r.json();

            if (data.pay_url) {
                // –£—Å–ø–µ—Ö: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ CryptoBot
                window.location.href = data.pay_url;
            } else {
                alert("–û—à–∏–±–∫–∞: " + (data.error || "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É"));
                btn.disabled = false;
                btn.innerText = "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ";
            }
        } catch (e) {
            console.error(e);
            alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
            btn.disabled = false;
            btn.innerText = "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ";
        }
    };
</script>

</body>
</html>
