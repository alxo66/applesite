<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ ‚Äî Apple Store</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ñ–æ—Ä–º—ã */
        .deposit-card {
            max-width: 500px;
            margin: 40px auto;
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #86868b;
        }
        input, select {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #d2d2d7;
            background: #fff;
            font-size: 17px;
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #0071e3;
        }
        .crypto-notice {
            background: #f5f5f7;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: #1d1d1f;
        }
    </style>
</head>
<body>

    <header class="header">
        <a href="index.html" class="logo">Apple Store</a>
        <nav>
            <a href="shop.html">–ú–∞–≥–∞–∑–∏–Ω</a>
            <a href="cabinet.html">–ö–∞–±–∏–Ω–µ—Ç</a>
            <a href="deposit.html" class="active">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</a>
        </nav>
    </header>

    <div class="container">
        <h1>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ. <span>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ.</span></h1>

        <div class="product deposit-card">
            <h2 style="margin-bottom: 20px; text-align: center;">–°—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É</h2>
            
            <div class="input-group">
                <label for="amount">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ($)</label>
                <input id="amount" type="number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000" min="500">
            </div>

            <div class="input-group">
                <label for="asset">–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤</label>
                <select id="asset">
                    <option value="USDT">USDT (Tether)</option>
                    <option value="BTC">Bitcoin</option>
                    <option value="TON">TON (Toncoin)</option>
                    <option value="ETH">Ethereum</option>
                </select>
            </div>

            <button id="payBtn" style="width: 100%; margin-top: 10px;">–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å</button>

            <div class="crypto-notice">
                <span style="font-size: 20px;">ü§ñ</span>
                <p>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ <b>CryptoBot</b>. –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ—Å—Ç—É–ø—è—Ç –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</p>
            </div>
        </div>
    </div>

    <footer>
        <p>–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ-—à–ª—é–∑—ã.</p>
    </footer>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º API (–ø—É—Ç—å API —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω –≤–Ω—É—Ç—Ä–∏ api.js)
        const API = "https://applestore-backend-production.up.railway.app";
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è User ID –∏–∑ localStorage (–∫–∞–∫ –≤ api.js)
        function getUserId() {
            return localStorage.getItem("applestore_user_id") || "guest";
        }

        document.getElementById("payBtn").onclick = async () => {
            const btn = document.getElementById("payBtn");
            const amount = Number(document.getElementById("amount").value);
            const asset = document.getElementById("asset").value;

            if (!amount || amount < 100) {
                alert("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî 500 $");
                return;
            }

            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫
            btn.disabled = true;
            btn.innerText = "–°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞...";

            try {
                const r = await fetch(`${API}/api/deposit`, {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json",
                        "x-user-id": getUserId() // –í–ê–ñ–ù–û –¥–ª—è —Ç–≤–æ–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞
                    },
                    body: JSON.stringify({
                        amount,
                        currency: asset // –≤ –±—ç–∫–µ–Ω–¥–µ –ø–æ–ª–µ –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è currency –∏–ª–∏ asset
                    })
                });

                const data = await r.json();

                if (data.pay_url) {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–ø–ª–∞—Ç—É –≤ CryptoBot
                    window.location.href = data.pay_url;
                } else {
                    alert("–û—à–∏–±–∫–∞: –±—ç–∫–µ–Ω–¥ –Ω–µ –≤–µ—Ä–Ω—É–ª —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É.");
                    btn.disabled = false;
                    btn.innerText = "–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å";
                }
            } catch (e) {
                console.error(e);
                alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º Railway.");
                btn.disabled = false;
                btn.innerText = "–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å";
            }
        };
    </script>

</body>
</html>
