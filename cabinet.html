<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Личный кабинет</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Личный кабинет</h1>

<div class="card">
  <h2>Баланс</h2>
  <p id="balance">Загрузка...</p>
</div>

<div class="card">
  <h2>История пополнений</h2>
  <table>
    <thead>
      <tr>
        <th>Дата</th>
        <th>Валюта</th>
        <th>Сумма</th>
        <th>Статус</th>
      </tr>
    </thead>
    <tbody id="history">
      <tr><td colspan="4">Загрузка...</td></tr>
    </tbody>
  </table>
</div>

<p id="error" style="color:red;"></p>

<script src="frontend/api.js"></script>
<script>
(async () => {
  try {
    const data = await apiFetch("/orders");

    document.getElementById("balance").innerText =
      data.balance + " ₽";

    const tbody = document.getElementById("history");
    tbody.innerHTML = "";

    data.history.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.date}</td>
        <td>${row.currency}</td>
        <td>${row.amount}</td>
        <td>${row.status}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch {
    document.getElementById("error").innerText =
      "Не удалось загрузить данные";
  }
})();
</script>

</body>
</html>
