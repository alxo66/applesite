<!DOCTYPE html>

<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Личный кабинет — AppleStore</title>
  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto; }
    body { margin: 0; background: #f5f5f7; color: #111; }
    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    h1 { margin-bottom: 16px; }

```
.card {
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,.06);
}

.balance {
  font-size: 32px;
  font-weight: 600;
}

.muted { color: #777; font-size: 14px; }

label { display: block; margin: 12px 0 4px; }
input, select, button {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 16px;
}

button {
  background: #000;
  color: #fff;
  border: none;
  margin-top: 12px;
  cursor: pointer;
}

button:disabled { opacity: .6; }

.list { margin-top: 8px; }
.item {
  padding: 10px 0;
  border-bottom: 1px solid #eee;
  font-size: 14px;
}

.status {
  font-weight: 500;
}

.status.pending { color: orange; }
.status.done { color: green; }
.status.reserved { color: #007aff; }
.status.completed { color: green; }

@media (max-width: 600px) {
  .balance { font-size: 26px; }
}
```

  </style>
</head>
<body>
  <div class="container">
    <h1>Личный кабинет</h1>

```
<!-- BALANCE -->
<div class="card">
  <div class="muted">Баланс</div>
  <div class="balance" id="balance">—</div>
  <div class="muted">Зарезервировано: <span id="reserved">—</span></div>
</div>

<!-- DEPOSIT -->
<div class="card">
  <h3>Пополнить баланс</h3>

  <label>Сумма</label>
  <input id="amount" type="number" min="1" placeholder="Введите сумму" />

  <label>Валюта</label>
  <select id="asset">
    <option value="USDT">USDT</option>
    <option value="BTC">BTC</option>
    <option value="ETH">ETH</option>
  </select>

  <button onclick="createInvoice()">Оплатить</button>
</div>

<!-- DEPOSITS -->
<div class="card">
  <h3>История пополнений</h3>
  <div class="list" id="deposits"></div>
</div>

<!-- ORDERS -->
<div class="card">
  <h3>Заказы</h3>
  <div class="list" id="orders"></div>
</div>
```

  </div>

  <script>
    const API = "https://applestore-backend-production.up.railway.app";

    async function loadCabinet() {
      const res = await fetch(API + "/api/cabinet");
      const data = await res.json();

      document.getElementById("balance").innerText = data.balance;
      document.getElementById("reserved").innerText = data.reserved;

      // deposits
      const depBox = document.getElementById("deposits");
      depBox.innerHTML = "";
      data.deposits.slice().reverse().forEach(d => {
        depBox.innerHTML += `
          <div class="item">
            ${d.amount} ${d.asset} —
            <span class="status ${d.status}">${d.status}</span>
          </div>`;
      });

      // orders
      const ordBox = document.getElementById("orders");
      ordBox.innerHTML = "";
      data.orders.slice().reverse().forEach(o => {
        ordBox.innerHTML += `
          <div class="item">
            ${o.product} — ${o.price}$ —
            <span class="status ${o.status}">${o.status}</span>
          </div>`;
      });
    }

    async function createInvoice() {
      const amount = document.getElementById("amount").value;
      const asset = document.getElementById("asset").value;

      if (!amount) return alert("Введите сумму");

      const res = await fetch(API + "/api/crypto/invoice", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, asset })
      });

      const data = await res.json();
      if (data.pay_url) {
        window.open(data.pay_url, "_blank");
      } else {
        alert("Ошибка создания счёта");
      }
    }

    loadCabinet();
    setInterval(loadCabinet, 5000);
  </script>

</body>
</html>
